version: 2

models:
  - name: base__marketplace__address
    description: "Base models grouping all addresses with their details"
    columns:
      - name: address_id
        description: '{{ doc("address_id") }}'
        tests:
          - unique
          - not_null
      - name: google_place_id
        description: '{{ doc("google_place_id") }}'
      - name: address_completed_with_google_places_at
        description: '{{ doc("address_completed_with_google_places_at") }}'
      - name: address_formatted_fr
        description: '{{ doc("address_formatted_fr") }}'
      - name: address_continent
        description: '{{ doc("address_continent") }}'
      - name: address_country
        description: '{{ doc("address_country") }}'
      - name: address_administrative_area_level_1_region_fr
        description: '{{ doc("address_administrative_area_level_1_region_fr") }}'
      - name: address_administrative_area_level_2_department_fr
        description: '{{ doc("address_administrative_area_level_2_department_fr") }}'
      - name: address_administrative_area_level_3_fr
        description: '{{ doc("address_administrative_area_level_3_fr") }}'
      - name: address_city_fr
        description: '{{ doc("address_city_fr") }}'
      - name: address_sublocality_level_2_fr
        description: '{{ doc("address_sublocality_level_2_fr") }}'
      - name: address_colloquial_area_fr
        description: '{{ doc("address_colloquial_area_fr") }}'
      - name: address_postal_town_fr
        description: '{{ doc("address_postal_town_fr") }}'
      - name: address_postal_code
        description: '{{ doc("address_postal_code") }}'
      - name: address_political_fr
        description: '{{ doc("address_political_fr") }}'

  - name: base__marketplace__ambassadors
    description: "Ambassadors accounts. Contains Mentors, Ambassadors, and VIPs."
    columns:
      - name: ambassador_id
        description: '{{ doc("ambassador_id") }}'
        tests:
          - unique
          - not_null
      - name: user_id
        description: '{{ doc("user_id") }}'
        tests:
          - unique
          - not_null
      - name: company_id
        description: '{{ doc("company_id") }}'
      - name: company_sector_id
        description: '{{ doc("company_sector_id") }}'
      - name: ambassador_legacy_ambassador_entity_id
        description: '{{ doc("ambassador_legacy_ambassador_entity_id") }}'
      - name: ambassador_inactive_user_id
        description: '{{ doc("ambassador_inactive_user_id") }}'
      - name: ambassador_denormalized_last_moderator_user_id
        description: '{{ doc("ambassador_denormalized_last_moderator_user_id") }}'
      - name: contact_request_id
        description: '{{ doc("contact_request_id") }}'
      - name: style_ids
        description: '{{ doc("style_ids") }}'
      - name: ambassador_created_at
        description: '{{ doc("ambassador_created_at") }}'
        tests:
          - not_null
      - name: ambassador_updated_at
        description: '{{ doc("ambassador_updated_at") }}'
      - name: ambassador_converted_from_mentor_at
        description: '{{ doc("ambassador_converted_from_mentor_at") }}'
      - name: ambassador_first_approved_at
        description: '{{ doc("ambassador_first_approved_at") }}'
      - name: ambassador_career_started_at
        description: '{{ doc("ambassador_career_started_at") }}'
      - name: ambassador_first_published_at
        description: '{{ doc("ambassador_first_published_at") }}'
      - name: ambassador_last_published_at
        description: '{{ doc("ambassador_last_published_at") }}'
      - name: ambassador_first_publication_requested_at
        description: '{{ doc("ambassador_first_publication_requested_at") }}'
        tests:
          - not_null:
              where: >
                first_published_at is not null
                and first_published_at >= '2017-11-06'
                and professional_type = "Mentor"
      - name: ambassador_last_publication_requested_at
        description: '{{ doc("ambassador_last_publication_requested_at") }}'
        tests:
          - not_null:
              where: >
                first_published_at is not null
                and first_published_at >= '2018-01-16'
                and professional_type = "Mentor"
      - name: ambassador_first_publication_request_completion_at
        description: '{{ doc("ambassador_first_publication_request_completion_at") }}'
      - name: ambassador_last_restricted_at
        description: '{{ doc("ambassador_last_restricted_at") }}'
      - name: ambassador_last_unrestricted_at
        description: '{{ doc("ambassador_last_unrestricted_at") }}'
      - name: ambassador_becomes_available_or_iced_up_at
        description: '{{ doc("ambassador_becomes_available_or_iced_up_at") }}'
      - name: ambassador_last_iced_up_at
        description: '{{ doc("ambassador_last_iced_up_at") }}'
      - name: ambassador_last_melted_at
        description: '{{ doc("ambassador_last_melted_at") }}'
      - name: ambassador_invitation_email
        description: '{{ doc("ambassador_invitation_email") }}'
      - name: ambassador_invitation_first_name
        description: '{{ doc("ambassador_invitation_first_name") }}'
      - name: ambassador_invitation_last_name
        description: '{{ doc("ambassador_invitation_last_name") }}'
      - name: ambassador_type_raw
        description: '{{ doc("ambassador_type_raw") }}'
      - name: ambassador_type
        description: '{{ doc("ambassador_type") }}'
      - name: ambassador_company_name
        description: '{{ doc("ambassador_company_name") }}'
        tests:
          - not_null:
              where: is_published is true
      - name: ambassador_company_size
        description: '{{ doc("ambassador_company_size") }}'
        tests:
          - not_null:
              where: is_published is true
      - name: ambassador_company_attributes
        description: '{{ doc("ambassador_company_attributes") }}'
      - name: ambassador_denormalized_company_logo_url
        description: '{{ doc("ambassador_denormalized_company_logo_url") }}'
      - name: ambassador_legacy_ambassador_entity_name
        description: '{{ doc("ambassador_legacy_ambassador_entity_name") }}'
      - name: ambassador_is_converted_from_ambassador
        description: '{{ doc("ambassador_is_converted_from_ambassador") }}'
      - name: ambassador_is_independent_company
        description: '{{ doc("ambassador_is_independent_company") }}'
      - name: ambassador_is_company_logo_unavailable
        description: '{{ doc("ambassador_is_company_logo_unavailable") }}'
      - name: ambassador_denormalized_last_moderated_at
        description: '{{ doc("ambassador_denormalized_last_moderated_at") }}'
      - name: ambassador_fun_sentence
        description: '{{ doc("ambassador_fun_sentence") }}'
      - name: ambassador_is_vip_account
        description: '{{ doc("ambassador_is_vip_account") }}'
      - name: ambassador_is_hidden_from_search
        description: '{{ doc("ambassador_is_hidden_from_search") }}'
      - name: ambassador_search_boost
        description: '{{ doc("ambassador_search_boost") }}'
      - name: ambassador_is_last_name_public
        description: '{{ doc("ambassador_is_last_name_public") }}'
      - name: ambassador_job_title
        description: '{{ doc("ambassador_job_title") }}'
      - name: ambassador_description
        description: '{{ doc("ambassador_description") }}'
      - name: ambassador_is_how_it_works_banner_hidden
        description: '{{ doc("ambassador_is_how_it_works_banner_hidden") }}'
      - name: ambassador_languages_for_exchanging_with_students
        description: '{{ doc("ambassador_languages_for_exchanging_with_students") }}'
      - name: ambassador_is_published
        description: '{{ doc("ambassador_is_published") }}'
      - name: ambassador_last_publication_request_utm
        description: '{{ doc("ambassador_last_publication_request_utm") }}'
      - name: ambassador_promotions
        description: '{{ doc("ambassador_promotions") }}'
      - name: ambassador_educations
        description: '{{ doc("ambassador_educations") }}'
      - name: ambassador_recommended_qualifications
        description: '{{ doc("ambassador_recommended_qualifications") }}'
      - name: ambassador_mandatory_skills
        description: '{{ doc("ambassador_mandatory_skills") }}'
      - name: ambassador_is_restricted
        description: '{{ doc("ambassador_is_restricted") }}'
      - name: ambassador_last_restricted_reason
        description: '{{ doc("ambassador_last_restricted_reason") }}'
      - name: ambassador_last_unrestricted_reason
        description: '{{ doc("ambassador_last_unrestricted_reason") }}'
      - name: ambassador_is_iced_up
        description: '{{ doc("ambassador_is_iced_up") }}'
      - name: ambassador_last_iced_up_reason
        description: '{{ doc("ambassador_last_iced_up_reason") }}'
      - name: ambassador_max_appointments_per_month
        description: '{{ doc("ambassador_max_appointments_per_month") }}'
      - name: ambassador_publication_request_completion_percentage
        description: '{{ doc("ambassador_publication_request_completion_percentage") }}'

  - name: base__marketplace__company_sectors
    description: "Model of all company sectors based on the LinkedIn classification"
    columns:
      - name: company_sector_id
        description: '{{ doc("company_sector_id") }}'
        tests:
          - unique
          - not_null
      - name: company_sector_created_at
        description: '{{ doc("company_sector_created_at") }}'
      - name: company_sector_updated_at
        description: '{{ doc("company_sector_updated_at") }}'
      - name: company_sector_name
        description: '{{ doc("company_sector_name") }}'
      - name: company_sector_normalized_name
        description: '{{ doc("company_sector_normalized_name") }}'
      - name: company_sector_linkedin_code
        description: '{{ doc("company_sector_linkedin_code") }}'
      - name: company_sector_hidden_from_search
        description: '{{ doc("company_sector_hidden_from_search") }}'

  - name: base__marketplace__users
    description: "Users accounts."
    columns:
      - name: user_id
        description: '{{ doc("user_id") }}'
        tests:
          - unique
          - not_null
      - name: intercom_user_id
        description: '{{ doc("intercom_user_id") }}'
        tests:
          - unique
      - name: france_travail_id
        description: '{{ doc("france_travail_id") }}'
        tests:
          - unique
      - name: widget_source_id
        description: '{{ doc("widget_source_id") }}'
      - name: user_created_at
        description: '{{ doc("user_created_at") }}'
      - name: user_updated_at
        description: '{{ doc("user_updated_at") }}'
      - name: user_soft_deleted_at
        description: '{{ doc("user_soft_deleted_at") }}'
      - name: user_cache_last_active_at
        description: '{{ doc("user_cache_last_active_at") }}'
      - name: user_reset_password_sent_at
        description: '{{ doc("user_reset_password_sent_at") }}'
      - name: user_widget_source_added_at
        description: '{{ doc("user_widget_source_added_at") }}'
      - name: user_is_ambivalent
        description: '{{ doc("user_is_ambivalent") }}'
      - name: user_first_name
        description: '{{ doc("user_first_name") }}'
      - name: user_last_name
        description: '{{ doc("user_last_name") }}'
      - name: user_email
        description: '{{ doc("user_email") }}'
      - name: user_unconfirmed_email
        description: '{{ doc("user_unconfirmed_email") }}'
      - name: user_normalized_phone
        description: '{{ doc("user_normalized_phone") }}'
      - name: user_avatar
        description: '{{ doc("user_avatar") }}'
      - name: user_languages
        description: '{{ doc("user_languages") }}'
      - name: user_meeting_preferences
        description: '{{ doc("user_meeting_preferences") }}'
      - name: user_meeting_place
        description: '{{ doc("user_meeting_place") }}'
      - name: user_situation
        description: '{{ doc("user_situation") }}'
        tests:
          - accepted_values:
              values:
              - "junior_high_school_student"
              - "senior_high_school_student"
              - "graduate_student"
              - "in_activity"
              - null
      - name: user_is_situation_confirmed_after_ambivalence
        description: '{{ doc("user_is_situation_confirmed_after_ambivalence") }}'
      - name: user_email_locale
        description: '{{ doc("user_email_locale") }}'
      - name: user_referrer_code
        description: '{{ doc("user_referrer_code") }}'
        tests:
          - unique
          - not_null
      - name: user_is_high_school_teacher
        description: '{{ doc("user_is_high_school_teacher") }}'
        tests:
          - not_null
      - name: user_is_oriane_ambassador
        description: '{{ doc("user_is_oriane_ambassador") }}'
        tests:
          - not_null
      - name: user_has_france_travail_connect
        description: '{{ doc("user_has_france_travail_connect") }}'
        tests:
          - not_null
      - name: user_is_subscribed_to_red_carpets
        description: '{{ doc("user_is_subscribed_to_red_carpets") }}'
      - name: user_has_videoconference_enabled
        description: '{{ doc("user_has_videoconference_enabled") }}'
      - name: user_is_user_soft_deleted
        description: '{{ doc("user_is_user_soft_deleted") }}'
      - name: user_soft_deleted_reason
        description: '{{ doc("user_soft_deleted_reason") }}'
      - name: user_is_anonymized
        description: '{{ doc("user_is_anonymized") }}'
      - name: user_sign_up_utm
        description: '{{ doc("user_sign_up_utm") }}'
